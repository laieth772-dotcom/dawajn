<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>نظام إدارة محمية الدوسري للدواجن</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #1b5e20; --secondary: #2e7d32; --accent: #ffa000;
            --danger: #c62828; --text: #333; --bg: #f4f7f6; --white: #ffffff;
            --sidebar-width: 260px;
        }

        body { font-family: 'Segoe UI', Tahoma, sans-serif; background: var(--bg); margin: 0; display: flex; overflow-x: hidden; }

        /* شاشة الدخول */
        #login-overlay {
            position: fixed; inset: 0; background: var(--primary); z-index: 9999;
            display: flex; justify-content: center; align-items: center;
        }
        .login-box { background: var(--white); padding: 40px; border-radius: 20px; width: 350px; text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.3); }

        /* القائمة الجانبية */
        aside {
            width: var(--sidebar-width); background: var(--primary); color: white;
            height: 100vh; position: fixed; right: 0; top: 0; transition: 0.3s;
            overflow-y: auto; z-index: 1000;
        }
        .nav-item { padding: 15px 20px; cursor: pointer; border-bottom: 1px solid rgba(255,255,255,0.1); display: flex; align-items: center; gap: 10px; transition: 0.3s; }
        .nav-item:hover { background: var(--secondary); padding-right: 30px; }
        .nav-group { background: rgba(0,0,0,0.2); padding: 10px 20px; font-size: 12px; color: var(--accent); font-weight: bold; }

        /* المحتوى الرئيسي */
        main { margin-right: var(--sidebar-width); width: calc(100% - var(--sidebar-width)); padding: 20px; transition: 0.3s; }
        .page { display: none; animation: fadeIn 0.4s ease; }
        .active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* البطاقات والجداول */
        .card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); margin-bottom: 20px; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 20px; }
        .stat-card { background: white; padding: 20px; border-radius: 12px; border-right: 6px solid var(--accent); }
        
        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th, td { padding: 12px; border: 1px solid #eee; text-align: center; }
        th { background: #f8f9fa; color: var(--primary); }

        input, select, button { width: 100%; padding: 12px; margin: 8px 0; border-radius: 8px; border: 1px solid #ddd; font-size: 14px; box-sizing: border-box; }
        .btn-action { background: var(--primary); color: white; border: none; font-weight: bold; cursor: pointer; }
        .btn-action:hover { background: var(--secondary); }

        @media (max-width: 768px) {
            aside { width: 0; overflow: hidden; }
            main { margin-right: 0; width: 100%; }
            .sidebar-open aside { width: var(--sidebar-width); }
        }
    </style>
</head>
<body class="sidebar-open">

    <div id="login-overlay">
        <div class="login-box">
            <i class="fas fa-shield-halved fa-3x" style="color: var(--primary);"></i>
            <h2>محمية الدوسري</h2>
            <p>نظام إدارة الدواجن المتكامل</p>
            <input type="text" id="user" placeholder="اسم المستخدم (admin)">
            <input type="password" id="pass" placeholder="كلمة المرور (123)">
            <button class="btn-action" onclick="login()">دخول آمن</button>
        </div>
    </div>

    <aside>
        <div style="padding: 20px; text-align: center; border-bottom: 1px solid rgba(255,255,255,0.2);">
            <i class="fas fa-kiwi-bird fa-2x"></i>
            <h3>لوحة التحكم</h3>
        </div>
        
        <div class="nav-group">العامة</div>
        <div class="nav-item" onclick="showPage('page-dashboard')"><i class="fas fa-home"></i> الرئيسية</div>
        <div class="nav-item" onclick="showPage('page-profile')"><i class="fas fa-user-circle"></i> الملف الشخصي</div>

        <div class="nav-group">إدارة الأفراخ</div>
        <div class="nav-item" onclick="showPage('page-batches')"><i class="fas fa-plus"></i> إضافة دفعة جديدة</div>
        <div class="nav-item" onclick="showPage('page-mortality')"><i class="fas fa-skull"></i> سجل النفوق اليومي</div>
        <div class="nav-item" onclick="showPage('page-vaccines')"><i class="fas fa-syringe"></i> جدول التحصينات</div>

        <div class="nav-group">العلف والأدوية</div>
        <div class="nav-item" onclick="showPage('page-feed')"><i class="fas fa-wheat-awn"></i> إدارة العلف</div>
        <div class="nav-item" onclick="showPage('page-meds')"><i class="fas fa-pills"></i> سجل الأدوية</div>

        <div class="nav-group">التجارة والمالية</div>
        <div class="nav-item" onclick="showPage('page-sales')"><i class="fas fa-cart-shopping"></i> المبيعات والمشتريات</div>
        <div class="nav-item" onclick="showPage('page-finance')"><i class="fas fa-money-bill-trend-up"></i> الأرباح والخسائر</div>

        <div class="nav-group">النظام</div>
        <div class="nav-item" onclick="location.reload()"><i class="fas fa-sign-out-alt"></i> تسجيل الخروج</div>
    </aside>

    <main>
        <div id="page-dashboard" class="page active">
            <header style="display: flex; justify-content: space-between; align-items: center;">
                <h2>مرحباً بك في محمية الدوسري</h2>
                <div id="date-now" style="font-weight: bold;"></div>
            </header>
            <div class="stats-grid">
                <div class="stat-card"><h3>إجمالي الأفراخ</h3><div id="stat-total-birds" style="font-size: 24px; font-weight: bold;">0</div></div>
                <div class="stat-card" style="border-right-color: var(--primary);"><h3>رصيد العلف</h3><div id="stat-total-feed" style="font-size: 24px; font-weight: bold;">0 كجم</div></div>
                <div class="stat-card" style="border-right-color: var(--danger);"><h3>نسبة النفوق</h3><div id="stat-mortality" style="font-size: 24px; font-weight: bold;">0%</div></div>
            </div>
            <div class="card">
                <h3>حالة الإنتاج (رسم بياني)</h3>
                <canvas id="mainChart" height="100"></canvas>
            </div>
        </div>

        <div id="page-batches" class="page">
            <div class="card">
                <h2>إضافة دفعة أفراخ جديدة</h2>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <input type="date" id="batch-date">
                    <input type="number" id="batch-count" placeholder="العدد">
                    <select id="batch-type">
                        <option value="لحم">دجاج لحم</option>
                        <option value="بيض">دجاج بيض</option>
                    </select>
                    <input type="text" id="batch-source" placeholder="المصدر/المورد">
                </div>
                <button class="btn-action" onclick="addBatch()">حفظ الدفعة الجديدة</button>
            </div>
            <div class="card">
                <h3>الدفعات الحالية وتحليل الأعمار</h3>
                <table id="batch-table">
                    <thead><tr><th>التاريخ</th><th>العدد</th><th>النوع</th><th>العمر الحالي</th><th>إجراء</th></tr></thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>

        <div id="page-feed" class="page">
            <div class="card">
                <h2>إدارة مخزون العلف</h2>
                <input type="number" id="feed-in" placeholder="كمية العلف الداخلة (كجم)">
                <button class="btn-action" onclick="updateFeed()">تحديث المخزون</button>
            </div>
            <div class="card" style="background: #fff8e1;">
                <h3><i class="fas fa-lightbulb"></i> توصية ذكية:</h3>
                <p id="feed-advice">بناءً على عمر الأفراخ والعدد، ستحتاج إلى 0 كجم علف لهذا اليوم.</p>
            </div>
        </div>

        <div id="page-finance" class="page">
            <h2>التقرير المالي العام</h2>
            <div class="stats-grid">
                <div class="stat-card" style="border-right-color: green;"><h3>إجمالي الإيرادات</h3><div id="total-revenue">0 د.ع</div></div>
                <div class="stat-card" style="border-right-color: red;"><h3>إجمالي التكاليف</h3><div id="total-expenses">0 د.ع</div></div>
            </div>
            <button class="btn-action" style="background: #1565c0;" onclick="exportData()"><i class="fas fa-file-excel"></i> تصدير البيانات إلى Excel</button>
        </div>
    </main>

    <script>
        // قاعدة البيانات المحلية
        let systemData = JSON.parse(localStorage.getItem('DousariDB')) || {
            batches: [], feedStock: 0, finances: { revenue: 0, expenses: 0 }, mortality: []
        };

        function login() {
            const u = document.getElementById('user').value;
            const p = document.getElementById('pass').value;
            if(u === "admin" && p === "123") {
                document.getElementById('login-overlay').style.fadeOut = "slow";
                document.getElementById('login-overlay').style.display = 'none';
                initDashboard();
            } else { alert("بيانات الدخول غير صحيحة!"); }
        }

        function showPage(id) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            if(id === 'page-batches') renderBatches();
        }

        function addBatch() {
            const date = document.getElementById('batch-date').value;
            const count = parseInt(document.getElementById('batch-count').value);
            const type = document.getElementById('batch-type').value;

            if(date && count) {
                systemData.batches.push({ id: Date.now(), date, count, type });
                saveData();
                renderBatches();
                alert("تم إضافة الدفعة بنجاح");
            }
        }

        function calculateAge(startDate) {
            const diffTime = Math.abs(new Date() - new Date(startDate));
            return Math.ceil(diffTime / (1000 * 60 * 60 * 24)) + " يوم";
        }

        function renderBatches() {
            const tbody = document.querySelector("#batch-table tbody");
            tbody.innerHTML = systemData.batches.map(b => `
                <tr>
                    <td>${b.date}</td>
                    <td>${b.count}</td>
                    <td>${b.type}</td>
                    <td>${calculateAge(b.date)}</td>
                    <td><button onclick="deleteBatch(${b.id})" style="background:red; color:white; border:none; border-radius:4px; padding:5px 10px;">حذف</button></td>
                </tr>
            `).join('');
            updateStats();
        }

        function deleteBatch(id) {
            systemData.batches = systemData.batches.filter(b => b.id !== id);
            saveData();
            renderBatches();
        }

        function updateStats() {
            const totalBirds = systemData.batches.reduce((sum, b) => sum + b.count, 0);
            document.getElementById('stat-total-birds').innerText = totalBirds;
            document.getElementById('stat-total-feed').innerText = systemData.feedStock;
            
            // حساب توصية العلف (تقريبياً: الطير يستهلك 150 جرام في المتوسط عند البلوغ)
            const advice = totalBirds * 0.15;
            document.getElementById('feed-advice').innerText = `بناءً على العدد الحالي، ستحتاج إلى حوالي ${advice.toFixed(1)} كجم علف يومياً.`;
        }

        function saveData() {
            localStorage.setItem('DousariDB', JSON.stringify(systemData));
        }

        function initDashboard() {
            document.getElementById('date-now').innerText = new Date().toLocaleDateString('ar-EG');
            updateStats();
            
            // رسم بياني بسيط للتوضيح
            const ctx = document.getElementById('mainChart').getContext('2d');
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['أسبوع 1', 'أسبوع 2', 'أسبوع 3', 'أسبوع 4'],
                    datasets: [{
                        label: 'معدل النمو',
                        data: [100, 400, 900, 1600],
                        borderColor: '#1b5e20',
                        fill: true,
                        backgroundColor: 'rgba(27, 94, 32, 0.1)'
                    }]
                }
            });
        }

        function exportData() {
            alert("هذه الميزة تقوم بتحميل ملف البيانات بصيغة JSON حالياً، في النسخة المتقدمة يتم ربطها بـ Excel.");
            console.log(systemData);
        }
    </script>
</body>
</html>
